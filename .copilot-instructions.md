# GitHub Copilot Instructions for RailsApp

## Project Overview

This is a **Rails 8.0.3 data visualization dashboard** built with modern best practices. The application provides interactive data visualization for sales and user analytics using **Turbo/Stimulus** (Hotwire) with **NO external JavaScript frameworks** and **NO Tailwind CSS**.

## Architecture & Tech Stack

### Core Technologies
- **Ruby 3.4.6** - Latest stable Ruby version
- **Rails 8.0.3** - Latest Rails with modern features
- **SQLite3** - In-memory database for development
- **Turbo + Stimulus** - Hotwire for SPA-like interactions
- **Pure CSS** - Custom styling with gradients, animations
- **Importmap** - ES6 modules without bundling

### Key Design Decisions
- **NO Docker** - Removed for later containerization
- **NO Tailwind CSS** - Custom CSS with modern design
- **NO complex JavaScript** - Pure CSS charts with minimal JS
- **NO external chart libraries** - Custom CSS-based visualizations
- **Rails conventions** - Following MVC patterns strictly

## Project Structure

### Models
- `Sale` - Product sales with validations, scopes, aggregations
- `UserAnalytic` - User engagement metrics with date-based queries

### Controllers
- `DashboardController` - Main dashboard with 3 views:
  - `index` - Overview with key metrics
  - `sales` - Sales analytics and trends
  - `analytics` - User engagement metrics

### Views & Styling
- **Custom CSS** in `app/assets/stylesheets/application.css`
- **CSS-only charts** using flexbox and height calculations
- **Responsive design** with mobile-first approach
- **Gradient design system** with purple/blue theme

### Testing Strategy
- **93.75% test coverage** (exceeds 80% requirement)
- **SimpleCov** for coverage reporting
- **44 unit tests** covering models, controllers, helpers
- **6 system tests** for full user journeys
- **Comprehensive fixtures** with realistic data

## Development Workflows

### Common Commands
```bash
# Start development server
rails server

# Run all tests with coverage
rails test

# Run system tests
rails test:system

# Show app statistics
rails app:stats

# Reset database with sample data
rails db:reset_with_data

# Generate coverage report
rails test:coverage
```

### Database & Seeds
- **975 sales records** across 6 categories (90 days of data)
- **3,158 user analytics records** from 959 unique users
- **$272,869.50 total revenue** in sample data
- Seeds generate realistic test data automatically

## Code Patterns & Conventions

### Model Patterns
```ruby
# Always include validations
validates :amount, presence: true, numericality: { greater_than: 0 }

# Use scopes for common queries
scope :recent, -> { where(sale_date: 30.days.ago..Date.current) }

# Class methods for aggregations
def self.total_revenue
  sum(:amount)
end
```

### Controller Patterns
```ruby
# Keep controllers thin, use model methods
def index
  @total_revenue = Sale.total_revenue
  @revenue_by_category = Sale.revenue_by_category
end
```

### View Patterns
```erb
<!-- Use helper methods for formatting -->
<%= number_with_delimiter(@total_revenue.to_f.round(2)) %>

<!-- CSS-based charts with calculated heights -->
<div class="bar" style="height: <%= (value.to_f / max_value * 250).round %>px;">
```

### CSS Patterns
```css
/* Modern gradients for visual appeal */
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

/* Hover effects for interactivity */
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
```

## Testing Guidelines

### Model Tests
- Test all validations and edge cases
- Test scopes and class methods
- Use fixtures for consistent test data
- Test aggregation methods thoroughly

### Controller Tests
- Test all action responses
- Verify instance variables are set
- Test navigation and routing
- Include edge cases (empty data)

### System Tests
- Test complete user journeys
- Verify responsive design
- Test navigation between pages
- Ensure charts render correctly

### Helper Tests
- Test all formatting methods
- Include edge cases (nil, zero values)
- Test calculation methods
- Verify return value formats

## Future Development Guidelines

### When Adding Features
1. **Follow Rails conventions** - Use generators, standard patterns
2. **Maintain test coverage** - Add tests for all new code
3. **Use CSS-first approach** - Avoid JavaScript unless necessary
4. **Keep models fat, controllers thin** - Business logic in models
5. **Update fixtures** - Keep test data realistic and comprehensive

### When Modifying Charts
1. **Pure CSS only** - No external chart libraries
2. **Responsive design** - Test on mobile devices
3. **Accessible colors** - Maintain contrast ratios
4. **Hover effects** - Enhance user experience
5. **Data-driven heights** - Calculate proportional sizes

### When Adding Dependencies
1. **Ask permission first** - Project prefers minimal dependencies
2. **Latest versions only** - Security patches are priority
3. **Update documentation** - Add to README and badges
4. **Test thoroughly** - Ensure compatibility

## Common Troubleshooting

### Database Issues
```bash
# Reset database completely
rails db:drop db:create db:migrate db:seed
```

### Test Issues
```bash
# Run specific test file
rails test test/models/sale_test.rb

# Run with verbose output
rails test -v
```

### Coverage Issues
- SimpleCov configuration in `test/test_helper.rb`
- Coverage reports in `coverage/index.html`
- Target: 80%+ line coverage (currently 93.75%)

## Security & Best Practices

- **Latest gem versions** - All dependencies up-to-date
- **Parameter validation** - Strong parameters in controllers
- **SQL injection prevention** - ActiveRecord queries only
- **XSS prevention** - Proper ERB escaping
- **CSRF protection** - Built-in Rails protection

## Deployment Considerations

- **No Docker currently** - Can be added later
- **SQLite for development** - Consider PostgreSQL for production
- **Asset pipeline ready** - Propshaft for efficient asset serving
- **Solid Cache/Queue** - Background job processing ready

## Contact & Support

This project follows Rails conventions and modern best practices. When in doubt:
1. Check Rails guides: https://guides.rubyonrails.org/
2. Follow existing patterns in the codebase
3. Maintain test coverage above 80%
4. Keep styling CSS-only
5. Preserve the minimalist JavaScript approach
